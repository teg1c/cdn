webpackJsonp([254],{bgWO:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("Yo4o"),r=o("nIsk"),i={name:"orderMap",data:function(){return{id:Number,markers:[],order:{},deliveryer:{},AMap:{},GMap:{},MapType:this.util.getStorage("MapType")}},methods:{onLoad:function(){var e=this;this.util.request({url:"errander/order/location",data:{id:this.id}}).then(function(t){var o=t.data.message;return o.errno?(e.util.$toast(o.message),!1):(e.order=o.message.order,e.deliveryer=o.message.deliveryer,3==e.order.status?(e.util.$toast("订单已完成！"),!1):void e.loadmap())})},loadmap:function(){var e=this;"google"==e.MapType?(e.GMap=Object(r.a)(),e.GMap.then(function(t){e.map=new t.maps.Map(document.getElementById("map-container"),{center:{lat:parseFloat(e.order.accept_location_x),lng:parseFloat(e.order.accept_location_y)},zoom:10,disableDefaultUI:!0});var o={};if(e.order.accept_location_y&&e.order.accept_location_x){var a=function(e,t){this.bounds_=e,this.map_=t,this.div_=null,this.setMap(t)};e.memberOverlay&&e.memberOverlay.setMap(null),(a.prototype=new t.maps.OverlayView).onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},a.prototype.onAdd=function(){var e=document.createElement("div");e.className="marker-mine-route",this.div_=e,this.getPanes().overlayLayer.appendChild(e)},a.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),o=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),a=this.div_;a.style.left=t.x-35+"px",a.style.top=o.y-35+"px"},o=new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(e.order.accept_location_x),parseFloat(e.order.accept_location_y))),e.memberOverlay=new a(o,e.map)}if(e.order.buy_location_x&&e.order.buy_location_y){var r=function(e,t){this.bounds_=e,this.map_=t,this.div_=null,this.setMap(t)};e.storeOverlay&&e.storeOverlay.setMap(null),(r.prototype=new t.maps.OverlayView).onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},r.prototype.onAdd=function(){var e=document.createElement("div");e.className="marker-start-route",this.div_=e,this.getPanes().overlayLayer.appendChild(e)},r.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),o=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),a=this.div_;a.style.left=t.x-23+"px",a.style.top=o.y-140+"px"},o=new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(e.order.buy_location_x),parseFloat(e.order.buy_location_y))),e.storeOverlay=new r(o,e.map)}function i(e,t){this.bounds_=e,this.map_=t,this.div_=null,this.setMap(t)}e.deliveryerOverlay&&e.deliveryerOverlay.setMap(null),i.prototype=new t.maps.OverlayView,i.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},i.prototype.onAdd=function(){var t=document.createElement("div");t.className="marker-deliveyer-route";var o=document.createElement("img");o.src=e.deliveryer.avatar,t.appendChild(o),this.div_=t,this.getPanes().overlayLayer.appendChild(t)},i.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),o=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),a=this.div_;a.style.left=t.x-26+"px",a.style.top=o.y-220+"px"},o=3==e.order.status?new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(e.order.delivery_success_location_x),parseFloat(e.order.delivery_success_location_y))):new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(e.deliveryer.location_x),parseFloat(e.deliveryer.location_y))),e.deliveryerOverlay=new i(o,e.map)})):(e.AMap=Object(a.a)(),e.AMap.then(function(t){(e.map=new t.Map("map-container",{resizeEnable:!0,center:[e.order.accept_location_y,e.order.accept_location_x],zoom:10}),(a=new t.Marker({position:[e.order.accept_location_y,e.order.accept_location_x],offset:new t.Pixel(-35,-35),content:'<div class="marker-mine-route"></div>'})).setMap(e.map),e.order.buy_location_x&&e.order.buy_location_y)&&(a=new t.Marker({position:[e.order.buy_location_y,e.order.buy_location_x],offset:new t.Pixel(-23,-74),content:'<div class="marker-start-route"></div>'})).setMap(e.map);if(3==e.order.status){e.map.panTo([e.order.delivery_success_location_y,e.order.delivery_success_location_x]);var o=e.deliveryer.avatar;(a=new t.Marker({position:[e.order.delivery_success_location_y,e.order.delivery_success_location_x],offset:new t.Pixel(-26,-80),content:'<div class="marker-deliveyer-route"><img src='+o+' alt=""/></div>'})).setMap(e.map)}else{e.map.panTo([e.deliveryer.location_y,e.deliveryer.location_x]);var a;o=e.deliveryer.avatar;(a=new t.Marker({position:[e.deliveryer.location_y,e.deliveryer.location_x],offset:new t.Pixel(-26,-80),content:'<div class="marker-deliveyer-route"><img src='+o+' alt=""/></div>'})).setMap(e.map),e.markers.push(a)}e.map.setFitView()}))},onRefresh:function(){var e=this;if(3==e.order.status)return!1;e.util.request({url:"system/common/deliveryer/location",data:{id:e.order.deliveryer_id}}).then(function(t){var o=t.data.message;if(o.errno)return e.util.$toast(o.message),!1;var a=o.message;"google"==e.MapType?e.GMap.then(function(t){function o(e,t){this.bounds_=e,this.map_=t,this.div_=null,this.setMap(t)}e.deliveryerOverlay&&e.deliveryerOverlay.setMap(null),o.prototype=new t.maps.OverlayView,o.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},o.prototype.onAdd=function(){var e=document.createElement("div");e.className="marker-deliveyer-route";var t=document.createElement("img");t.src=a.avatar,e.appendChild(t),this.div_=e,this.getPanes().overlayLayer.appendChild(e)},o.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),o=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),a=this.div_;a.style.left=t.x-26+"px",a.style.top=o.y-220+"px"};var r=new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(a.location_x),parseFloat(a.location_y)));e.deliveryerOverlay=new o(r,e.map)}):e.AMap.then(function(t){var o=new t.Marker({position:[a.location_y,a.location_x],offset:new t.Pixel(-26,-80),content:'<div class="marker-deliveyer-route"><img src="'+a.avatar+'" alt=""/></div>'});e.map.remove(e.markers),o.setMap(e.map),e.markers.push(o),e.map.setFitView()})})},onQuestion:function(){this.$dialog.confirm({message:"要获取最新位置，请点击刷新按钮；如果配送员远离您，那可能是正在为更早下单的用户配送，请耐心等待~",showCancelButton:!1})}},created:function(){if(!this.$route.query.id)return!1;this.id=this.$route.query.id},mounted:function(){var e=this;this.onLoad(),setInterval(function(){e.onRefresh()},3e4)}},n={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"order-map"}},[t("div",{staticClass:"map-wrap",attrs:{id:"map-container"}}),this._v(" "),t("router-link",{staticClass:"icons back-icon",attrs:{tag:"div",to:this.util.getUrl({path:"/plugin/pages/paotui/detail",query:{id:this.id}})}},[t("div",{staticClass:"icon icon-arrow-left"})]),this._v(" "),t("div",{staticClass:"icons refresh-icon",on:{click:this.onRefresh}},[t("div",{staticClass:"icon icon-refresh"})]),this._v(" "),t("div",{staticClass:"icons question-icon",on:{click:this.onQuestion}},[t("div",{staticClass:"icon icon-question font-20"})])],1)},staticRenderFns:[]};var s=o("VU/8")(i,n,!1,function(e){o("qLY5")},null,null);t.default=s.exports},qLY5:function(e,t){}});
//# sourceMappingURL=254.609fa773ec09d25de3c2.js.map