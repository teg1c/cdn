webpackJsonp([50],{IwyG:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("Gu7T"),o=i.n(a),s=i("woOf"),d=i.n(s),c=i("Dd8w"),n=i.n(c),l=i("Cz8s"),r=i("mzkE"),g=i("kEnp"),h=i("NYxO"),p={data:function(){return{id:0,sid:0,showPreLoading:!0,styleContent:"#fff",is_grant:0,title:"",active:1,diydata:{diy:{data:{},fixedsearch:{},is_has_goodsTab:0,is_has_location:0},superRedpacketData:{errno:0,message:{},is_show:!0},popup:{storeSearch:!1,serviceQrcode:!1},config:{},guideData:{is_show:!1},cart_sum:0,categorySelectedIndex:0,categorySelectedId:0,categoryAll:[],categorySelected:{child:[{}]},childSelectedIndex:0,childSelectedId:0,goodsAll:[],goodsItem:{orderby:{type:"",value:""}},goodsLoading:!0,store:{},shopPage:{},vanColHeight:667},store:{},menufooter:{},storeCouponTop:0,storeOnsaleTop:0,storeEvaluateTop:0,goodsTabActive:0,goodsTabActiveReal:0,goodsTabFixed:0,goodsTabHeights:[],goodsTabOffsetTop:0,followHeight:0,scrollFromClickTab:!1,showFixedSearchBar:!1,shop_style:"",ParentPopupSpecShow:!1,popupBuySvip:!1,goodsActive:{}}},components:{PublicHeader:l.a,PublicFooter:r.a,diy:g.a},computed:n()({},Object(h.c)(["istore","icart"]),{goodsSpecNum:function(){if(!this.icart||!this.icart.data1||!this.icart.data1[this.goodsActive.id])return 0;var t=this.goodsActive.activeOptionId;return this.icart.data1[this.goodsActive.id][t]?this.icart.data1[this.goodsActive.id][t].num:0}}),watch:{"icart.num":{handler:function(){this.diydata.cart_sum=this.icart.num}},icart:function(){var t=this.icart.data,e=this.diydata.categoryAll;if(t)for(var i in e)if(e[i].total=0,e[i].child&&e[i].child.length>0)for(var a in e[i].child){e[i].child[a].total=0;var o=0,s=0;for(var d in t)for(var c in t[d])t[d][c].cid==e[i].id&&(s+=t[d][c].num,e[i].total=s,t[d][c].child_id==e[i].child[a].id&&(o+=t[d][c].num,e[i].child[a].total=o))}else{s=0;for(var d in t)for(var c in t[d])t[d][c].cid==e[i].id&&(s+=t[d][c].num,e[i].total=s)}else for(var i in e)if(e[i].total=0,e[i].child)for(var a in e[i].child)e[i].child[a].total=0;this.diydata.categoryAll=e},$route:function(){this.id=this.$route.query.id},id:function(){this.onLoad()}},methods:n()({},Object(h.b)(["setLocation","getLocation","replaceStore","replaceCart"]),{onLoad:function(){var t=this;this.util.request({url:"wmall/shop/diy",data:{sid:this.sid,id:this.id,menufooter:1}}).then(function(e){t.showPreLoading=!1;var i=e.data.message;if(i.errno)t.$toast(i.message);else{if(t.diydata.config=i.message.config_mall,t.diydata.diy=i.message.diy,t.diydata.diy.guide)if(1==t.diydata.diy.guide.params.status&&"interval"==t.diydata.diy.guide.params.show_setting){var a=t.util.getStorage("guideStorage");(!a||a&&!a.show)&&(t.util.setStorage("guideStorage",{show:1},60*t.diydata.diy.guide.params.interval_time),t.diydata.guideData.is_show=!0)}else 1==t.diydata.diy.guide.params.status&&"everytime"==t.diydata.diy.guide.params.show_setting&&(t.util.removeStorage("guideStorage"),t.diydata.guideData.is_show=!0);t.styleContent={"background-color":t.diydata.diy.data.page.background},t.diydata.superRedpacketData=i.message.superRedpacketData,t.diydata.superRedpacketData.is_show=!0,t.title=t.diydata.diy.data.page.title||"门店首页",t.util.setWXTitle(t.title),t.menufooter=window.menufooter,t.cart=i.message.cart.message.cart,t.diydata.cart_sum=t.cart.num,t.store=i.message.store,t.replaceStore(t.store),t.replaceCart(t.cart),t.store=i.message.store,t.shop_style=t.store.data.shop_style;var o=t.diydata.diy.type;6==o?t.$nextTick(function(){t.onCalculateStoreNavHeight(),1==t.diydata.diy.is_has_goodsTab&&t.onCalculateGoodsTabItemHeight()}):7==o&&(1==t.diydata.diy.is_has_storebasic&&(t.diydata.categoryAll=i.message.category,t.diydata.goodsItem={page:2,psize:30,empty:0,data:i.message.goods,orderby:{type:"",value:""}},t.diydata.goodsItem.data.length<t.diydata.goodsItem.psize&&(t.diydata.goodsItem.loaded=!0,t.diydata.goodsItem.data.length||(t.diydata.goodsItem.empty=1)),t.diydata.categorySelectedId=i.message.cid,t.diydata.childSelectedId=i.message.child_id,t.diydata.categorySelectedIndex=i.message.cindex,t.diydata.goodsAll[t.diydata.categorySelectedIndex]=[],t.diydata.goodsAll[t.diydata.categorySelectedIndex][t.diydata.childSelectedIndex]=t.diydata.goodsItem,t.diydata.categorySelected=i.message.category[t.diydata.categorySelectedIndex]||{},t.diydata.store=t.store,t.diydata.shopPage=t.store.data.shopPage),setTimeout(function(){var e=document.documentElement.clientHeight;t.diydata.vanColHeight=e,document.getElementById("public-header")&&(t.diydata.vanColHeight=t.diydata.vanColHeight-46),document.getElementById("public-footer")&&(t.diydata.vanColHeight=t.diydata.vanColHeight-50)},50))}})},onChangeTab:function(t){if(0==t)var e=this.storeCouponTop-46;else if(1==t)e=this.storeOnsaleTop-46;else if(2==t)e=this.storeEvaluateTop-46;window.scrollTo(0,e)},getCoupon:function(){var t=this;this.util.request({url:"wmall/channel/coupon/get",data:{sid:this.sid}}).then(function(e){var i=e.data.message;0==i.errno?(t.util.$toast(i.message,"",1e3),t.is_grant=1):t.util.$toast("领取失败","",1e3)})},onCloseRedpacket:function(){this.diydata.superRedpacketData.is_show=!1,this.diydata.superRedpacketData=d()({},this.diydata.superRedpacketData)},onCalculateStoreNavHeight:function(){var t=document.getElementsByClassName("diy-store-coupon");t&&t.length>0&&(this.storeCouponTop=document.getElementsByClassName("diy-store-coupon")[0].offsetTop);var e=document.getElementsByClassName("diy-store-onsale");e&&e.length>0&&(this.storeOnsaleTop=document.getElementsByClassName("diy-store-onsale")[0].offsetTop);var i=document.getElementsByClassName("diy-store-evaluate");i&&i.length>0&&(this.storeEvaluateTop=document.getElementsByClassName("diy-store-evaluate")[0].offsetTop)},onToggleService:function(){this.diydata.popup.serviceQrcode=!this.diydata.popup.serviceQrcode},onToggleGoodsTab:function(t){this.scrollFromClickTab=!0;var e=this.goodsTabOffsetTop-44;t.index>=1&&(e=this.goodsTabHeights[t.index-1]-44),e-=this.followHeight,this.diydata.diy.is_has_location&&e>100?(this.goodsTabFixed=2,e-=52):this.util.isWeixin()?this.goodsTabFixed=1:(this.goodsTabFixed=3,e-=46),window.scrollTo(0,e),this.goodsTabActive=t.index},onCalculateGoodsTabItemHeight:function(){this.goodsTabOffsetTop=document.getElementsByClassName("goods-tab-inner")[0].offsetTop,this.goodsTabOffsetTop-=document.getElementsByClassName("van-tabs")[0].clientHeight-44,document.getElementById("follow")&&(this.followHeight=document.getElementsByClassName("follow-tips")[0].clientHeight,this.goodsTabOffsetTop-=this.followHeight);for(var t=document.getElementsByClassName("goods-tab-item"),e=this.goodsTabOffsetTop,i=[],a=0;a<t.length;a++){e+=t[a].clientHeight,i.push(e)}this.goodsTabHeights=i},onChangeGoodsTabActive:function(t){this.goodsTabActiveReal=t.value},onToggleCategory:function(t){t.cid;var e=t.index,i=0;"child"==t.from?(i=e,this.diydata.childSelectedIndex=i,this.diydata.categoryAll[this.diydata.categorySelectedIndex].childSelectedIndex=i,this.diydata.categorySelected=this.diydata.categoryAll[this.diydata.categorySelectedIndex]):(this.diydata.categoryAll[e].childSelectedIndex>0&&(i=this.diydata.categoryAll[e].childSelectedIndex),this.diydata.categorySelected=this.diydata.categoryAll[e],this.diydata.categorySelectedIndex=e,this.diydata.childSelectedIndex=i,this.diydata.categoryAll[e].childSelectedIndex=i),this.diydata.categorySelectedId=this.diydata.categorySelected.id,this.diydata.childSelectedId=0,this.diydata.categorySelected.child&&this.diydata.categorySelected.child.length>0&&(this.diydata.childSelectedId=this.diydata.categorySelected.child[i].id),this.onGetGoods()},onGetGoods:function(){var t=this;if(this.diydata.goodsLoading,this.diydata.goodsAll[this.diydata.categorySelectedIndex]||(this.diydata.goodsAll[this.diydata.categorySelectedIndex]=[]),this.diydata.goodsItem=this.diydata.goodsAll[this.diydata.categorySelectedIndex][this.diydata.childSelectedIndex],this.diydata.goodsItem){if(this.diydata.goodsItem.empty)return!1;if(this.diydata.goodsItem.loaded)return console.log("商品全部加载完成"),!1}else this.diydata.goodsItem={page:1,psize:30,empty:0,loaded:!1,data:[],orderby:{type:"",value:""}};this.diydata.goodsLoading=!0,this.util.request({url:"wmall/store/goods/goods",data:{sid:this.sid,page:this.diydata.goodsItem.page,psize:this.diydata.goodsItem.psize,cid:this.diydata.categorySelectedId,child_id:this.diydata.childSelectedId,type:this.diydata.goodsItem.orderby.type,value:this.diydata.goodsItem.orderby.value}}).then(function(e){t.diydata.goodsLoading=!1;var i=e.data.message.message;t.diydata.goodsItem.data=[].concat(o()(t.diydata.goodsItem.data),o()(i.goods)),t.diydata.goodsItem.page++,i.goods.length<t.diydata.goodsItem.psize&&(t.diydata.goodsItem.loaded=!0,i.goods.length||(t.diydata.goodsItem.empty=1)),t.diydata.goodsAll[t.diydata.categorySelectedIndex]||(t.diydata.goodsAll[t.diydata.categorySelectedIndex]=[]),t.diydata.goodsAll[t.diydata.categorySelectedIndex][t.diydata.childSelectedIndex]=t.diydata.goodsItem})},onOrderby:function(t){var e=t.type,i=t.value;this.diydata.goodsItem={page:1,psize:30,empty:0,data:[],orderby:{type:e,value:i}},this.diydata.goodsAll[this.diydata.categorySelectedIndex][this.diydata.childSelectedIndex]=this.diydata.goodsItem,this.onGetGoods()},onParentPlus:function(t,e,i,a,o){var s=this;this.goodsActive=e;var d=0;if(0==this.icart.pindan_id)if(1==this.icart.is_buysvip)d=1;else if(this.icart.svip_buy_show>=1&&1==e.svip_buy_show){if(1==o)return this.goodsActive.activeOption&&(this.goodsActive.activeOption.origin_price>0?this.goodsActive.origin_price=this.goodsActive.activeOption.origin_price:this.goodsActive.origin_price=this.goodsActive.activeOption.price,this.goodsActive.activeOption.svip_price>0?this.goodsActive.svip_price=this.goodsActive.activeOption.svip_price:this.goodsActive.svip_price=this.goodsActive.activeOption.price),void(this.popupBuySvip=!0);2==o?this.popupBuySvip=!1:3==o&&(this.popupBuySvip=!1,d=1)}var c=e.id||e.goods_id,n=e.activeOptionId||i,l={sid:this.istore.id,goods_id:c,option_id:n,num:1,sign:"+",is_buysvip:d};this.util.request({url:"wmall/store/goods/cart",data:l}).then(function(t){if((t=t.data.message).errno)return s.$toast(t.message),!1;t.message.msg&&s.$toast(t.message.msg),s.replaceCart(t.message.cart)})},onParentMinus:function(t,e,i){var a=this,o=0;1==this.icart.is_buysvip&&(o=1);var s=t.id||t.goods_id,d=t.activeOptionId||e,c={sid:this.istore.id,goods_id:s,option_id:d,num:1,sign:"-",is_buysvip:o};this.util.request({url:"wmall/store/goods/cart",data:c}).then(function(t){if((t=t.data.message).errno)return a.$toast(t.message),!1;a.replaceCart(t.message.cart)})},onParentSelectOption:function(t){this.goodsActive=t,this.goods=t,this.ParentPopupSpecShow=!0,this.goods.activeOptions||this.onParentGoodsOptionInit()},onParentGoodsOptionInit:function(){if(this.goodsActive=this.goods,this.goodsActive.activeOptions={option:0,attrs:[],optionSelected:0,attrsSelected:[],num:0},1==this.goodsActive.is_options&&(this.goodsActive.activeOptions.option=this.goodsActive.options[0].id,this.goodsActive.activeOptions.optionSelected=this.goodsActive.options[0].id),1==this.goodsActive.is_attrs)for(var t=0;t<this.goodsActive.attrs.length;t++)this.goodsActive.activeOptions.attrs.push(t+"s0"),this.goodsActive.activeOptions.attrsSelected[t]=0;this.onParentToggleActiveOption()},onParentToggleActiveOption:function(t){var e=this.goodsActive;t?e.activeOptionId=t:(e.activeOptionId=e.activeOptions.option,e.activeOptions.attrs.length>0&&(e.activeOptionId=e.activeOptionId+"_"+e.activeOptions.attrs.join("v"))),e.activeOption=e.options_data[e.activeOptionId],e.activeOption.num=this.parentGetSpecNum(),this.goodsActive=d()({},e)},parentGetSpecNum:function(){if(!this.icart||!this.icart.data1||!this.icart.data1[this.goodsActive.id])return 0;var t=this.goodsActive.activeOptionId;return this.icart.data1[this.goodsActive.id][t]?this.icart.data1[this.goodsActive.id][t].num:0},onParentToggleOption:function(t,e,i){var a=this.goods;"option"==i?(a.activeOptions.option=t,a.activeOptions.optionSelected=t):(a.activeOptions.attrs[t]=t+"s"+e,a.activeOptions.attrsSelected[t]=e),this.goodsActive=a,this.onParentToggleActiveOption()}}),created:function(){this.query=this.util.parseQuery(this.$route.query),this.sid=this.query.sid,this.id=this.query.id},mounted:function(){var t=this;t.onLoad(),window.addEventListener("scroll",function(){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(t.showFixedSearchBar=e>100,1==t.diydata.diy.is_has_goodsTab){var i=44;if(t.util.isWeixin()||(i=90),t.diydata.diy.is_has_location&&t.showFixedSearchBar&&(i=96),(e=Math.ceil(e+i))>=t.goodsTabOffsetTop?t.diydata.diy.is_has_location&&t.showFixedSearchBar?t.goodsTabFixed=2:t.util.isWeixin()?t.goodsTabFixed=1:t.goodsTabFixed=3:t.goodsTabFixed=0,!t.scrollFromClickTab)for(var a=t.goodsTabHeights,o=a.length,s=0;s<o;s++){if(!a[s+1]){t.goodsTabActive=s;break}if(e<a[s]){t.goodsTabActive=s;break}if(e>=a[s]&&e<a[s+1]){t.goodsTabActive=s+1;break}}}t.scrollFromClickTab=!1})}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:"shop-"+t.shop_style,attrs:{id:"shop-diy"}},[i("public-header",{attrs:{title:t.title}}),t._v(" "),i("public-footer",{attrs:{preLoading:t.showPreLoading,menufooter:t.menufooter}}),t._v(" "),i("div",{staticClass:"container",class:{"has-child-0":2==t.diydata.diy.storebasic_style,"has-child-4":2==t.diydata.diy.storebasic_style&&t.diydata.categorySelected&&t.diydata.categorySelected.child&&t.diydata.categorySelected.child.length>0&&t.diydata.categorySelected.child.length<=4,"has-child-8":2==t.diydata.diy.storebasic_style&&t.diydata.categorySelected&&t.diydata.categorySelected.child&&t.diydata.categorySelected.child.length>4},style:t.styleContent},[i("diy",{attrs:{diydata:t.diydata,active:t.active,is_grant:t.is_grant,preLoading:t.showPreLoading,goodsTabActive:t.goodsTabActive,goodsTabFixed:t.goodsTabFixed,showFixedSearchBar:t.showFixedSearchBar},on:{onChangeTab:t.onChangeTab,getCoupon:t.getCoupon,onCloseRedpacket:t.onCloseRedpacket,onToggleService:t.onToggleService,onToggleGoodsTab:t.onToggleGoodsTab,onChangeGoodsTabActive:t.onChangeGoodsTabActive,onParentPlus:t.onParentPlus,onParentSelectOption:t.onParentSelectOption,onToggleCategory:t.onToggleCategory,onOrderby:t.onOrderby,onGetGoods:t.onGetGoods}})],1),t._v(" "),t.ParentPopupSpecShow?i("van-popup",{staticClass:"options-popup",model:{value:t.ParentPopupSpecShow,callback:function(e){t.ParentPopupSpecShow=e},expression:"ParentPopupSpecShow"}},[i("div",{staticClass:"options-dialog"},[i("div",{staticClass:"muti-close",on:{click:function(e){t.ParentPopupSpecShow=!1}}}),t._v(" "),i("div",{staticClass:"muti-wrap"},[i("div",{staticClass:"muti-food-title border-1px-b"},[t._v("\n\t\t\t\t\t"+t._s(t.goodsActive.title)+"\n\t\t\t\t")]),t._v(" "),i("div",{staticClass:"muti-cont"},[i("div",{staticClass:"muti-cont-seinner"},[1==t.goodsActive.is_options?i("div",{staticClass:"muti-sec first"},[i("div",{staticClass:"muti-sec-title"},[t._v("规格")]),t._v(" "),i("div",{staticClass:"muti-choice"},[t._l(t.goodsActive.options,function(e,a){return[i("div",{class:{selected:t.goodsActive.activeOptions.optionSelected==e.id},on:{click:function(i){return t.onParentToggleOption(e.id,"","option")}}},[t._v(t._s(e.name))])]})],2)]):t._e(),t._v(" "),1==t.goodsActive.is_attrs?i("div",{staticClass:"muti-sec"},[t._l(t.goodsActive.attrs,function(e,a){return[i("div",{staticClass:"muti-sec-title"},[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"muti-choice"},[t._l(e.label,function(e,o){return[i("div",{class:{selected:t.goodsActive.activeOptions.attrsSelected[a]==o},on:{click:function(e){return t.onParentToggleOption(a,o,"attr")}}},[t._v(t._s(e))])]})],2)]})],2):t._e()])]),t._v(" "),i("div",{staticClass:"muti-choose"},[i("div",{staticClass:"muti-oprt"},[i("div",{staticClass:"muti-cart-oprt clearfix"},[i("div",{staticClass:"add-food"},[i("van-icon",{staticStyle:{"background-color":"#6BBA50"},attrs:{name:"plus"},on:{click:function(e){return t.onParentPlus(e,t.goodsActive,"","","1")}}})],1),t._v(" "),t.goodsSpecNum?[i("div",{staticClass:"food-num"},[t._v(t._s(t.goodsSpecNum))]),t._v(" "),i("div",{staticClass:"remove-food"},[i("div",{staticClass:"remove icon icon-minus",on:{click:function(e){return t.onParentMinus(t.goodsActive)}}})])]:t._e()],2)]),t._v(" "),i("div",{staticClass:"muti-info"},[i("div",{staticClass:"muti-price"},[t._v(t._s(t.Lang.dollarSign)+t._s(t.goodsActive.activeOption.price))]),t._v(" "),i("div",{staticClass:"muti-type"},[t._v("("+t._s(t.goodsActive.activeOption.name)+")")])])])])])]):t._e(),t._v(" "),i("van-popup",{staticClass:"buy-svip",model:{value:t.popupBuySvip,callback:function(e){t.popupBuySvip=e},expression:"popupBuySvip"}},[i("div",{staticClass:"popup-svip-title"},[t._v("客官，专享价限超级会员享受哦")]),t._v(" "),i("div",{staticClass:"svip-img"},[i("div",{staticClass:"svip-vs-left"},[i("i",{staticClass:"icon icon-crownfill"}),t._v(" "),i("div",{staticClass:"font-12"},[t._v("会员专享价")]),t._v(" "),i("div",{staticClass:"svip-vs-price"},[i("span",{staticClass:"font-14"},[t._v(t._s(t.Lang.dollarSign))]),t._v(t._s(t.goodsActive.svip_price))])]),t._v(" "),i("div",{staticClass:"svip-vs-right"},[i("div",{staticClass:"svip-putong-title"},[t._v("普通用户价格")]),t._v(" "),i("div",{staticClass:"svip-putong-price"},[i("span",{staticClass:"font-14"},[t._v(t._s(t.Lang.dollarSign))]),t._v(t._s(t.goodsActive.origin_price))])])]),t._v(" "),i("div",{staticClass:"buy-svip-text"},[t._v("即刻加入超级会员，尊享众多会员优惠")]),t._v(" "),i("button",{staticClass:"svip-price-btn font-16 margin-15-t"},[i("div",{staticClass:"font-bold",on:{click:function(e){return t.onParentPlus(e,t.goodsActive,"","","3")}}},[t._v("会员专享价购买")]),t._v(" "),i("div",{staticClass:"font-12 padding-5-t"},[t._v("(订单结算时成为会员享优惠)")])]),t._v(" "),i("van-button",{staticClass:"price-btn font-16 margin-15-t",attrs:{size:"normal"},on:{click:function(e){return t.onParentPlus(e,t.goodsActive,"","","2")}}},[t._v("原价购买")])],1)],1)},staticRenderFns:[]};var u=i("VU/8")(p,v,!1,function(t){i("S0hj")},null,null);e.default=u.exports},S0hj:function(t,e){}});
//# sourceMappingURL=50.1bf382c16388655a861a.js.map