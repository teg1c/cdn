webpackJsonp([129],{"8Qyg":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("Dd8w"),n=o.n(a),s=o("Gu7T"),c=o.n(s),i=o("NYxO"),r={data:function(){return{addresses:[],showSearch:!1,key:"",searchAddress:[],addressSearchHistory:[],getNowLocationing:!1,MapType:"gaode"}},components:{PublicHeader:o("Cz8s").a},watch:{key:function(){var t=this,e=this.key;this.showSearch=!!e,this.searchAddress=[];var o="system/common/map/suggestion";"google"==this.MapType&&(o="system/common/map/suggestion_google"),e&&this.util.request({url:o,data:{key:e}}).then(function(e){var o=e.data.message;o.errno||(t.searchAddress=[].concat(c()(t.searchAddress),c()(o.message)))})}},methods:n()({},Object(i.b)(["replaceState","getLocation","setLocation"]),{onLoad:function(){var t=this;t.MapType=t.util.getStorage("MapType");var e=t.util.getStorage("addressSearchHistory");e&&e.length&&e.length>0&&(t.addressSearchHistory=[].concat(c()(t.addressSearchHistory),c()(e))),t.getLocation(),t.locationInfo.location_x?t.onGetPos():t.util.getLocation({successLocation:function(e){t.setLocation({location_x:e.location_x,location_y:e.location_y}),t.onGetPos()},fail:function(e){t.util.$toast("获取定位失败, 你可以手动收缩地址")}})},onGetPos:function(){var t=this,e="system/common/map/regeo";"google"==t.MapType&&(e="system/common/map/regeo_google"),t.util.request({url:e,data:{latitude:t.locationInfo.location_x,longitude:t.locationInfo.location_y,convert:0}}).then(function(e){var o=e.data.message;o.errno||(o=o.message).pois&&o.pois.length>0&&(t.addresses=[].concat(c()(o.pois)))})},chooseLocation:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={address:t.address,location_x:t.location_x,location_y:t.location_y};this.replaceState({key:"searchLocationInfo",val:o}),e&&(o.name=t.name,this.addressSearchHistory.push(o),this.util.setStorage("addressSearchHistory",this.addressSearchHistory)),this.$router.go(-1)},onGetNowLocation:function(){var t=this;t.getNowLocationing=!0,t.util.getLocation({successLocation:function(t){},successAddress:function(e){t.replaceState({key:"searchLocationInfo",val:locationInfo}),t.getNowLocationing=!1,t.$router.go(-1)},fail:function(e){t.getNowLocationing=!1,t.util.$toast("获取定位失败,你可以手动搜索地址")},MapType:t.MapType})}}),computed:n()({},Object(i.c)(["searchLocationInfo","locationInfo"])),mounted:function(){this.onLoad()}},l={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"shop-location"}},[o("public-header",{attrs:{title:"选择地址"}}),t._v(" "),o("div",{staticClass:"content"},[o("div",{staticClass:"search-header-wrap van-hairline--bottom"},[o("div",{staticClass:"search-header"},[o("van-search",{attrs:{"show-action":"",background:"#fff",placeholder:"请输入您的地址"},model:{value:t.key,callback:function(e){t.key=e},expression:"key"}},[o("div",{attrs:{slot:"action"},slot:"action"},[t._v("搜索")])])],1)]),t._v(" "),t.showSearch?o("van-cell-group",t._l(t.searchAddress,function(e,a){return o("van-cell",{key:a,attrs:{title:e.address,label:e.name},on:{click:function(o){return t.chooseLocation(e,!0)}}})}),1):[o("div",{staticClass:"location",on:{click:t.onGetNowLocation}},[o("van-icon",{attrs:{name:"location"}}),t._v(" "+t._s(1==t.getNowLocationing?"正在获取定位...":"点击定位当前位置")+"\n\t\t\t")],1),t._v(" "),t.addresses.length&&t.addresses.length>0?[o("div",{staticClass:"item-title"},[o("van-icon",{attrs:{name:"time"}}),t._v("附近的地址\n\t\t\t\t")],1),t._v(" "),o("van-cell-group",t._l(t.addresses,function(e,a){return o("van-cell",{key:a,attrs:{title:e.address,label:e.name},on:{click:function(o){return t.chooseLocation(e)}}})}),1)]:t._e(),t._v(" "),t.addressSearchHistory.length&&t.addressSearchHistory.length>0?[o("div",{staticClass:"item-title"},[o("van-icon",{attrs:{name:"location"}}),t._v("搜索历史\n\t\t\t\t")],1),t._v(" "),o("van-cell-group",t._l(t.addressSearchHistory,function(e,a){return o("van-cell",{key:a,attrs:{title:e.address,label:e.name},on:{click:function(o){return t.chooseLocation(e)}}})}),1)]:t._e()]],2)],1)},staticRenderFns:[]};var d=o("VU/8")(r,l,!1,function(t){o("gDU4")},null,null);e.default=d.exports},gDU4:function(t,e){}});
//# sourceMappingURL=129.7be0a8ab15957cb8959b.js.map