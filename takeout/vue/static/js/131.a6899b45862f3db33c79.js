webpackJsonp([131],{"+kDF":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o("Gu7T"),i=o.n(s),a=o("woOf"),n=o.n(a),r=o("Cz8s"),l=o("+TmT"),c={components:{PublicHeader:r.a,Uploader:l.a},data:function(){return{id:Number,delivery_service:0,goods_quality:0,note:" ",goods:[],thumbs:[],newGoods:[],order:{},comment:{id:0},tools:[],showPreLoading:!0}},methods:{onAddGoodsTag:function(t){var e=this.$refs.textarea,o=t.goods_title;e.addTag(o),this.keepLastIndex(e.$refs.wTextareaContent)},keepLastIndex:function(t){if(window.getSelection)t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd();else if(document.selection){var e;(e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select()}},onLoad:function(){var t=this;this.$route.query.id?this.id=this.$route.query.id:this.$toast("订单不存在或已删除！"),this.util.request({url:"wmall/order/comment/index",data:{id:this.id}}).then(function(e){t.showPreLoading=!1;var o=e.data.message;if(o.errno)t.$toast(o.message);else{console.log(o),t.order=n()(t.order,o.message.order),o.message.goods&&(t.goods=[].concat(i()(t.goods),i()(o.message.goods))),t.goods.forEach(function(e,o){var s={id:e.id,goods_id:e.goods_id,activity:e.activity};t.newGoods.push(s)}),t.comment=t.util.extend(t.comment,o.message.comment),t.comment&&t.comment.id>0&&(t.delivery_service=t.comment.delivery_service,t.goods_quality=t.comment.goods_quality,t.note=t.comment.note,t.thumbs=[].concat(i()(t.comment.thumbs)));var s=t.$refs.textarea;t.keepLastIndex(s.$refs.wTextareaContent)}}),this.util.isGlala()&&this.util.requestPermissionList({perm:["storage","camera","photos"]})},favorOppose:function(t,e){t=t;"favor"==(e=e)?(this.goods[t].activity=1,this.newGoods[t].activity=1):(this.goods[t].activity=2,this.newGoods[t].activity=2)},onGetImgsUrl:function(t){this.thumbs=t},onSubmit:function(){var t=this;if(1==this.order.order_type&&!this.delivery_service)return this.$toast("请您评价配送服务"),!1;if(!this.goods_quality)return this.$toast("请您评价商品质量"),!1;var e={id:this.id,note:this.note,goods_quality:this.goods_quality,deliverScore:this.delivery_service,thumbs:this.thumbs,goods:this.newGoods};this.util.request({url:"wmall/order/comment/post",method:"post",data:e}).then(function(e){var o=e.data.message;if(o.errno)return t.util.$toast(o.message),!1;t.comment&&t.comment.id>0?t.util.$toast("修改成功",t.util.getUrl({path:"/pages/member/comment",query:{}}),1500,"replace"):t.util.$toast(o.message,t.util.getUrl({path:"/pages/order/detail",query:{id:t.id}}),1500,"replace")})}},mounted:function(){this.onLoad()}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"order-comment"}},[o("public-header",{attrs:{title:"添加评论"}}),t._v(" "),o("div",{staticClass:"content"},[1==t.order.order_type?[o("div",{staticClass:"content-block-title"},[t._v("配送评价")]),t._v(" "),o("van-cell-group",[o("van-cell",[o("div",{staticClass:"flex",attrs:{slot:"title"},slot:"title"},[o("span",{staticClass:"van-cell-text"},[t._v("配送服务")]),t._v(" "),o("van-rate",{staticClass:"flex",attrs:{size:20,count:5,color:"#ff2d4b","void-color":"#FF6C81"},model:{value:t.delivery_service,callback:function(e){t.delivery_service=e},expression:"delivery_service"}})],1)])],1)]:t._e(),t._v(" "),o("div",{staticClass:"content-block-title"},[t._v("商品评价")]),t._v(" "),o("van-cell-group",[o("van-cell",[o("div",{staticClass:"flex",attrs:{slot:"title"},slot:"title"},[o("span",{staticClass:"van-cell-text"},[t._v("商品质量")]),t._v(" "),o("van-rate",{staticClass:"flex",attrs:{size:20,count:5,color:"#ff2d4b","void-color":"#FF6C81"},model:{value:t.goods_quality,callback:function(e){t.goods_quality=e},expression:"goods_quality"}})],1)]),t._v(" "),t._l(t.goods,function(e,s){return o("van-cell",{key:s,attrs:{title:e.goods_title}},[o("div",{staticClass:"favor-oppose",attrs:{slot:"right-icon"},slot:"right-icon"},[o("label",{on:{click:function(e){return t.favorOppose(s,"favor")}}},[o("input",{staticClass:"radio",attrs:{type:"radio",value:"1"},domProps:{checked:1==e.activity}}),t._v(" "),o("span",{staticClass:"favor"})]),t._v(" "),o("label",{on:{click:function(e){return t.favorOppose(s,"oppose")}}},[o("input",{staticClass:"radio",attrs:{type:"radio",value:"2"},domProps:{checked:2==e.activity}}),t._v(" "),o("span",{staticClass:"oppose"})])])])})],2),t._v(" "),o("div",{staticClass:"content-block-title"},[t._v("写点什么")]),t._v(" "),o("w-textarea",{ref:"textarea",attrs:{tools:t.tools},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}),t._v(" "),o("div",{staticClass:"goods-tag van-hairline--top"},t._l(t.goods,function(e,s){return o("div",{key:s,staticClass:"goods-tag-item",on:{click:function(o){return t.onAddGoodsTag(e)}}},[t._v(t._s(e.goods_title))])}),0),t._v(" "),o("div",{staticClass:"content-block-title"},[t._v("有图有真相")]),t._v(" "),o("uploader",{attrs:{value:t.thumbs,max:6},on:{onGetUrl:t.onGetImgsUrl}}),t._v(" "),o("div",{staticClass:"save-btn"},[o("van-button",{attrs:{size:"large"},on:{click:function(e){return t.onSubmit()}}},[t._v("提交评论")])],1)],2),t._v(" "),t.showPreLoading?o("iloading"):t._e()],1)},staticRenderFns:[]};var u=o("VU/8")(c,d,!1,function(t){o("s4II")},null,null);e.default=u.exports},s4II:function(t,e){}});
//# sourceMappingURL=131.a6899b45862f3db33c79.js.map