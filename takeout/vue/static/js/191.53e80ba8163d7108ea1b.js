webpackJsonp([191],{"/Crh":function(t,e){},EDeD:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Gu7T"),i=a.n(s),n={data:function(){return{isRefresh:!1,chats:{page:1,psize:50,loading:!1,finished:!1,data:[]},showPreLoading:!0}},methods:{onLoad:function(t){var e=this;if(!0===t&&(e.chats={page:1,psize:50,loading:!0,finished:!1,data:[]}),e.chats.finished)return!1;e.util.request({url:"kefu/member/index",data:{page:e.chats.page,psize:e.chats.psize}}).then(function(a){e.showPreLoading=!1;var s=a.data.message;if(s.errno)e.util.$toast(s.message);else{var n=(s=s.message).chats.chats;n&&n.length>0?(e.chats.data=[].concat(i()(e.chats.data),i()(n)),n.length<e.chats.psize&&(e.chats.finished=!0)):e.chats.finished=!0,e.chats.page++,e.chats.loading=!1,!0===t&&(e.isRefresh=!1)}})},onCloseChat:function(t){var e=this,a=this;a.$dialog.confirm({title:"确定从会话列表移除该会话吗"}).then(function(){a.util.request({url:"kefu/member/delete",data:{chatid:a.chats.data[t].id}}).then(function(e){var s=e.data.message;s.errno?a.util.$toast(s.message):a.$delete(a.chats.data,t)})}).catch(function(){e.onLoad(!0)})},onGetMessage:function(t){t.chat&&this.onLoad(!0)},initWebSocket:function(){this.iwebsocket.onGetMessage=this.onGetMessage}},mounted:function(){this.initWebSocket()},destroyed:function(){this.iwebsocket.onGetMessage=null},components:{PublicHeader:a("Cz8s").a}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"kefu-index"}},[a("public-header",{attrs:{title:"消息中心"}}),t._v(" "),a("div",{staticClass:"content font-14"},[a("van-pull-refresh",{on:{refresh:function(e){return t.onLoad(!0)}},model:{value:t.isRefresh,callback:function(e){t.isRefresh=e},expression:"isRefresh"}},[a("van-list",{staticClass:"chat-list",attrs:{finished:t.chats.finished,offset:100,"immediate-check":!0},on:{load:t.onLoad},model:{value:t.chats.loading,callback:function(e){t.$set(t.chats,"loading",e)},expression:"chats.loading"}},[t._l(t.chats.data,function(e,s){return[a("van-swipe-cell",{attrs:{"right-width":70}},[a("router-link",{staticClass:"chat-item",attrs:{to:t.util.getUrl({path:"/plugin/pages/kefu/chat",query:{relation:e.relation,kefuopenid:e.kefuopenid,kefuunionid:e.kefuunionid}}),tag:"div"}},[a("div",{staticClass:"item-inner",class:{"van-hairline--top":s>0}},[a("div",{staticClass:"avatar"},[a("img",{staticClass:"img-100",attrs:{src:e.kefuavatar,alt:""}})]),t._v(" "),a("div",{staticClass:"info"},[a("div",{staticClass:"flex-lr"},[a("div",{staticClass:"nickname ellipsis "},[t._v(t._s(e.kefunickname))]),t._v(" "),a("div",{staticClass:"lasttime ellipsis c-gray"},[t._v(t._s(e.lasttime_cn))])]),t._v(" "),a("div",{staticClass:"last-content w-100 ellipsis c-gray font-13"},[t._v(t._s(e.content))])]),t._v(" "),e.notread>0?a("div",{staticClass:"not-read"},[t._v(t._s(e.notread))]):t._e()])]),t._v(" "),a("span",{staticClass:"del-chat",attrs:{slot:"right"},on:{click:function(e){return e.stopPropagation(),t.onCloseChat(s)}},slot:"right"},[t._v("删除")])],1)]})],2)],1)],1),t._v(" "),t.showPreLoading?a("iloading"):t._e()],1)},staticRenderFns:[]};var c=a("VU/8")(n,o,!1,function(t){a("/Crh")},null,null);e.default=c.exports}});
//# sourceMappingURL=191.53e80ba8163d7108ea1b.js.map