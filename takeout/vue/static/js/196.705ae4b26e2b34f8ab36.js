webpackJsonp([196],{ggge:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Gu7T"),i=r.n(a),s=r("Yo4o"),n=r("nIsk"),o={name:"orderMap",data:function(){return{id:Number,markers:[],center:{lat:"",lng:""},order:{},deliveryer_marker:[],AMap:{},GMap:{},MapType:this.util.getStorage("MapType")}},methods:{onLoad:function(){var e=this;this.util.request({url:"wmall/order/index/location",data:{id:this.id}}).then(function(t){var r=t.data.message;return r.errno?(e.util.$toast(r.message),!1):(e.order=r.message.order,5!=e.order.status&&(e.markers=[].concat(i()(e.markers),i()(r.message.markers)),e.center.lat=r.message.markers[0].latitude,e.center.lng=r.message.markers[0].longitude,void e.loadmap()))})},loadmap:function(){var e=this;"google"==e.MapType?(e.GMap=Object(n.a)(),e.GMap.then(function(t){e.map=new t.maps.Map(document.getElementById("map-container"),{center:{lat:parseFloat(e.center.lat),lng:parseFloat(e.center.lng)},zoom:10,disableDefaultUI:!0});var r={};if(e.markers[0].longitude&&e.markers[0].latitude){var a=function(e,t){this.bounds_=e,this.map_=t,this.div_=null,this.setMap(t)};e.memberOverlay&&e.memberOverlay.setMap(null),(a.prototype=new t.maps.OverlayView).onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},a.prototype.onAdd=function(){var e=document.createElement("div");e.className="marker-mine-route",this.div_=e,this.getPanes().overlayLayer.appendChild(e)},a.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),r=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),a=this.div_;a.style.left=t.x-35+"px",a.style.top=r.y-35+"px"},r=new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(e.markers[0].latitude),parseFloat(e.markers[0].longitude))),e.memberOverlay=new a(r,e.map)}if(e.markers[2].longitude&&e.markers[2].latitude){var i=function(e,t){this.bounds_=e,this.map_=t,this.div_=null,this.setMap(t)};e.storeOverlay&&e.storeOverlay.setMap(null),(i.prototype=new t.maps.OverlayView).onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},i.prototype.onAdd=function(){var t=document.createElement("div");t.className="marker-start-head-route";var r=document.createElement("img");r.src=e.markers[2].vue_icon,t.appendChild(r),this.div_=t,this.getPanes().overlayLayer.appendChild(t)},i.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),r=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),a=this.div_;a.style.left=t.x-35+"px",a.style.top=r.y-140+"px"},r=new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(e.markers[2].latitude),parseFloat(e.markers[2].longitude))),e.storeOverlay=new i(r,e.map)}function s(e,t){this.bounds_=e,this.map_=t,this.div_=null,this.setMap(t)}e.deliveryerOverlay&&e.deliveryerOverlay.setMap(null),s.prototype=new t.maps.OverlayView,s.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},s.prototype.onAdd=function(){var t=document.createElement("div");t.className="marker-deliveyer-route";var r=document.createElement("img");r.src=e.markers[1].vue_icon,t.appendChild(r),this.div_=t,this.getPanes().overlayLayer.appendChild(t)},s.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),r=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),a=this.div_;a.style.left=t.x-26+"px",a.style.top=r.y-220+"px"},r=5==e.order.status?new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(e.order.delivery_success_location_x),parseFloat(e.order.delivery_success_location_y))):new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(e.markers[1].latitude),parseFloat(e.markers[1].longitude))),e.deliveryerOverlay=new s(r,e.map)})):(e.AMap=Object(s.a)(),Object(s.a)().then(function(t){var r;(e.map=new t.Map("map-container",{resizeEnable:!0,center:[e.center.lng,e.center.lat],zoom:10}),e.markers[0].longitude&&e.markers[0].latitude)&&(r=new t.Marker({position:[e.markers[0].longitude,e.markers[0].latitude],offset:new t.Pixel(-26,-80),content:'<div class="marker-mine-route"></div>'})).setMap(e.map);e.markers[2].longitude&&e.markers[2].latitude&&(r=new t.Marker({position:[e.markers[2].longitude,e.markers[2].latitude],offset:new t.Pixel(-33,-70),content:'<div class="marker-start-head-route"><img src="'+e.markers[2].vue_icon+'" alt=""/></div>'})).setMap(e.map);5==e.order.status?(r=new t.Marker({position:[e.order.delivery_success_location_y,e.order.delivery_success_location_x],offset:new t.Pixel(-26,-80),content:'<div class="marker-deliveyer-route"><img src='+params.deliveryer.avatar+' alt=""/></div>'})).setMap(e.map):e.markers[1].longitude&&e.markers[1].latitude&&((r=new t.Marker({position:[e.markers[1].longitude,e.markers[1].latitude],offset:new t.Pixel(-26,-80),content:'<div class="marker-deliveyer-route"><img src="'+e.markers[1].vue_icon+'" alt=""/></div>'})).setMap(e.map),e.deliveryer_marker.push(r));e.map.setFitView()}))},onRefresh:function(){var e=this;if(5==e.order.status)return!1;e.util.request({url:"system/common/deliveryer/location",data:{id:e.order.deliveryer_id}}).then(function(t){var r=t.data.message;if(r.errno)return e.util.$toast(r.message),!1;var a=r.message;"google"==e.MapType?e.GMap.then(function(t){function r(e,t){this.bounds_=e,this.map_=t,this.div_=null,this.setMap(t)}e.deliveryerOverlay&&e.deliveryerOverlay.setMap(null),r.prototype=new t.maps.OverlayView,r.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},r.prototype.onAdd=function(){var e=document.createElement("div");e.className="marker-deliveyer-route";var t=document.createElement("img");t.src=a.avatar,e.appendChild(t),this.div_=e,this.getPanes().overlayLayer.appendChild(e)},r.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),r=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),a=this.div_;a.style.left=t.x-26+"px",a.style.top=r.y-220+"px"};var i=new t.maps.LatLngBounds(new t.maps.LatLng(parseFloat(a.location_x),parseFloat(a.location_y)));e.deliveryerOverlay=new r(i,e.map)}):e.AMap.then(function(t){var r=new t.Marker({position:[a.location_y,a.location_x],offset:new t.Pixel(-26,-80),content:'<div class="marker-deliveyer-route"><img src="'+a.avatar+'" alt=""/></div>'});e.map.remove(e.deliveryer_marker),r.setMap(e.map),e.deliveryer_marker.push(r),e.map.setFitView()})})},onQuestion:function(){this.$dialog.confirm({message:"要获取最新位置，请点击刷新按钮；如果配送员远离您，那可能是正在为更早下单的用户配送，请耐心等待~",showCancelButton:!1})}},created:function(){if(!this.$route.query.id)return!1;this.id=this.$route.query.id},mounted:function(){var e=this;this.onLoad(),setInterval(function(){e.onRefresh()},3e4)}},l={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"order-map"}},[t("div",{attrs:{id:"map-container"}}),this._v(" "),t("router-link",{staticClass:"icons back-icon",attrs:{tag:"div",to:this.util.getUrl({path:"/pages/order/detail",query:{id:this.id}})}},[t("div",{staticClass:"icon icon-arrow-left"})]),this._v(" "),t("div",{staticClass:"icons refresh-icon",on:{click:this.onRefresh}},[t("div",{staticClass:"icon icon-refresh"})]),this._v(" "),t("div",{staticClass:"icons question-icon",on:{click:this.onQuestion}},[t("div",{staticClass:"icon icon-question font-20"})])],1)},staticRenderFns:[]};var d=r("VU/8")(o,l,!1,function(e){r("nDJU")},null,null);t.default=d.exports},nDJU:function(e,t){}});
//# sourceMappingURL=196.705ae4b26e2b34f8ab36.js.map