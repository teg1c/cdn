webpackJsonp([115],{aiZS:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("woOf"),s=o.n(a),i=o("Dd8w"),d=o.n(i),n=o("Cz8s"),r=o("mzkE"),l=o("kEnp"),c=o("NYxO"),g={data:function(){return{sid:0,showPreLoading:!0,styleContent:"#fff",is_grant:0,title:"",active:1,diydata:{diy:{data:{},fixedsearch:{},is_has_goodsTab:0,is_has_location:0},superRedpacketData:{errno:0,message:{},is_show:!0},popup:{storeSearch:!1,serviceQrcode:!1},config:{},guideData:{is_show:!1},cart_sum:0},store:{},menufooter:{},storeCouponTop:0,storeOnsaleTop:0,storeEvaluateTop:0,goodsTabActive:0,goodsTabActiveReal:0,goodsTabFixed:0,goodsTabHeights:[],goodsTabOffsetTop:0,followHeight:0,scrollFromClickTab:!1,showFixedSearchBar:!1,shop_style:""}},components:{PublicHeader:n.a,PublicFooter:r.a,diy:l.a},computed:d()({},Object(c.c)(["istore","icart"])),watch:{"icart.num":{handler:function(){this.diydata.cart_sum=this.icart.num}}},methods:d()({},Object(c.b)(["setLocation","getLocation","replaceStore","replaceCart"]),{onLoad:function(){var e=this;this.util.request({url:"wmall/shop/index",data:{sid:this.sid,menufooter:1}}).then(function(t){e.showPreLoading=!1;var o=t.data.message;if(o.errno)e.$toast(o.message);else{if(e.diydata.config=o.message.config_mall,e.diydata.diy=e.util.extend(e.diydata.diy,o.message.diy),console.log("this.diydatathis.diydata"),console.log(e.diydata),e.diydata.diy.guide)if(1==e.diydata.diy.guide.params.status&&"interval"==e.diydata.diy.guide.params.show_setting){var a=e.util.getStorage("guideStorage");(!a||a&&!a.show)&&(e.util.setStorage("guideStorage",{show:1},60*e.diydata.diy.guide.params.interval_time),e.diydata.guideData.is_show=!0)}else 1==e.diydata.diy.guide.params.status&&"everytime"==e.diydata.diy.guide.params.show_setting&&(e.util.removeStorage("guideStorage"),e.diydata.guideData.is_show=!0);e.styleContent={"background-color":e.diydata.diy.data.page.background},e.diydata.superRedpacketData=o.message.superRedpacketData,e.diydata.superRedpacketData.is_show=!0,e.title=e.diydata.diy.data.page.title||"门店首页",e.util.setWXTitle(e.title),console.log(window.menufooter),e.menufooter=window.menufooter,e.cart=o.message.cart.message.cart,e.diydata.cart_sum=e.cart.num,e.store=o.message.store,e.replaceStore(e.store),e.replaceCart(e.cart),e.store=o.message.store,e.shop_style=e.store.data.shop_style,e.$nextTick(function(){e.onCalculateStoreNavHeight(),1==e.diydata.diy.is_has_goodsTab&&e.onCalculateGoodsTabItemHeight()})}})},onChangeTab:function(e){if(0==e)var t=this.storeCouponTop-46;else if(1==e)t=this.storeOnsaleTop-46;else if(2==e)t=this.storeEvaluateTop-46;window.scrollTo(0,t)},getCoupon:function(){var e=this;this.util.request({url:"wmall/channel/coupon/get",data:{sid:this.sid}}).then(function(t){var o=t.data.message;0==o.errno?(e.util.$toast(o.message,"",1e3),e.is_grant=1):e.util.$toast("领取失败","",1e3)})},onCloseRedpacket:function(){this.diydata.superRedpacketData.is_show=!1,this.diydata.superRedpacketData=s()({},this.diydata.superRedpacketData)},onCalculateStoreNavHeight:function(){var e=document.getElementsByClassName("diy-store-coupon");e&&e.length>0&&(this.storeCouponTop=document.getElementsByClassName("diy-store-coupon")[0].offsetTop);var t=document.getElementsByClassName("diy-store-onsale");t&&t.length>0&&(this.storeOnsaleTop=document.getElementsByClassName("diy-store-onsale")[0].offsetTop);var o=document.getElementsByClassName("diy-store-evaluate");o&&o.length>0&&(this.storeEvaluateTop=document.getElementsByClassName("diy-store-evaluate")[0].offsetTop)},onToggleGoodsTab:function(e){this.scrollFromClickTab=!0;var t=this.goodsTabOffsetTop-44;e.index>=1&&(t=this.goodsTabHeights[e.index-1]-44),t-=this.followHeight,this.diydata.diy.is_has_location&&t>100?(this.goodsTabFixed=2,t-=52):this.util.isWeixin()?this.goodsTabFixed=1:(this.goodsTabFixed=3,t-=46),window.scrollTo(0,t),this.goodsTabActive=e.index},onCalculateGoodsTabItemHeight:function(){this.goodsTabOffsetTop=document.getElementsByClassName("goods-tab-inner")[0].offsetTop,this.goodsTabOffsetTop-=document.getElementsByClassName("van-tabs")[0].clientHeight-44,document.getElementById("follow")&&(this.followHeight=document.getElementsByClassName("follow-tips")[0].clientHeight,this.goodsTabOffsetTop-=this.followHeight);for(var e=document.getElementsByClassName("goods-tab-item"),t=this.goodsTabOffsetTop,o=[],a=0;a<e.length;a++){t+=e[a].clientHeight,o.push(t)}this.goodsTabHeights=o},onChangeGoodsTabActive:function(e){this.goodsTabActiveReal=e.value}}),created:function(){this.query=this.util.parseQuery(this.$route.query),this.sid=this.query.sid},mounted:function(){var e=this;e.onLoad(),window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(e.showFixedSearchBar=t>100,1==e.diydata.diy.is_has_goodsTab){var o=44;if(e.util.isWeixin()||(o=90),e.diydata.diy.is_has_location&&e.showFixedSearchBar&&(o=96),(t=Math.ceil(t+o))>=e.goodsTabOffsetTop?e.diydata.diy.is_has_location&&e.showFixedSearchBar?e.goodsTabFixed=2:e.util.isWeixin()?e.goodsTabFixed=1:e.goodsTabFixed=3:e.goodsTabFixed=0,!e.scrollFromClickTab)for(var a=e.goodsTabHeights,s=a.length,i=0;i<s;i++){if(!a[i+1]){e.goodsTabActive=i;break}if(t<a[i]){e.goodsTabActive=i;break}if(t>=a[i]&&t<a[i+1]){e.goodsTabActive=i+1;break}}}e.scrollFromClickTab=!1})}},u={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{class:"shop-"+e.shop_style,attrs:{id:"shop-index"}},[e.menufooter&&e.menufooter.data?o("public-footer",{attrs:{preLoading:e.showPreLoading,menufooter:e.menufooter}}):e._e(),e._v(" "),o("div",{staticClass:"container",style:e.styleContent},[o("diy",{attrs:{diydata:e.diydata,active:e.active,is_grant:e.is_grant,preLoading:e.showPreLoading,goodsTabActive:e.goodsTabActive,goodsTabFixed:e.goodsTabFixed,showFixedSearchBar:e.showFixedSearchBar},on:{onChangeTab:e.onChangeTab,getCoupon:e.getCoupon,onCloseRedpacket:e.onCloseRedpacket,onToggleGoodsTab:e.onToggleGoodsTab,onChangeGoodsTabActive:e.onChangeGoodsTabActive}})],1)],1)},staticRenderFns:[]};var h=o("VU/8")(g,u,!1,function(e){o("fjo5")},null,null);t.default=h.exports},fjo5:function(e,t){}});
//# sourceMappingURL=115.b42e9a315fd8ca798f36.js.map