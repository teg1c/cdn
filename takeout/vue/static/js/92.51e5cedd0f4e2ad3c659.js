webpackJsonp([92],{DZ2u:function(t,e){},Hgoo:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("Gu7T"),s=i.n(o),r=i("Dd8w"),a=i.n(r),n=i("NYxO"),l={name:"orderNote",components:{PublicHeader:i("Cz8s").a},data:function(){return{query:{},sids:"",note:"",sid:Number,order_note:[],takeoutOrderNote:[],editStatus:!1,invoices:[],radio:0,type:"note",channel:"",showPreLoading:!0,invoiceTitle:"",title:"添加备注"}},methods:a()({},Object(n.b)(["setOrderExtra","setMallOrderExtra"]),{onSaveNote:function(){this.util.setStorage("takeoutOrderNote",this.takeoutOrderNote),this.util.$toast("标签保存成功"),this.editStatus=!1},onDeleteNote:function(t){this.$delete(this.takeoutOrderNote,t)},onLoad:function(){var t=this;this.util.request({url:"wmall/order/create/note",data:{sid:this.sid,type:this.type}}).then(function(e){t.showPreLoading=!1;var i=e.data.message;if(i.errno)t.$toast(i.message);else if(i=i.message,"note"==t.type){var o=t.util.getStorage("takeoutOrderNote");o&&(t.takeoutOrderNote=o),t.order_note=[].concat(s()(t.order_note),s()(i.store.order_note))}else"invoice"==t.type&&(t.util.setWXTitle("添加发票"),t.title="添加发票",1==i.store.invoice_status?t.invoices=[].concat(s()(t.invoices),s()(i.invoices)):"mall"==t.channel?t.util.$toast("该门店不支持开发票",t.util.getUrl({path:"/mall/pages/order/create",query:{}}),1e3,"replace"):t.util.$toast("该门店不支持开发票",t.util.getUrl({path:"/pages/order/create",query:{sid:t.sid}}),1e3,"replace"))})},onChooseLabel:function(t){if(this.editStatus)return this.util.$toast("请先保存标签"),!1;this.note=this.note+" "+t},onSubmit:function(){var t=this;"note"==t.type&&t.editStatus?t.$dialog.confirm({message:"还未保存标签，是否保存"}).then(function(){t.onSaveNote(),t.onSubmitPost()}).catch(function(){t.onSubmitPost()}):t.onSubmitPost()},onSubmitPost:function(){"mall"==this.channel?("note"==this.type?this.setMallOrderExtra({sid:this.sid,key:"note",val:this.note}):"invoice"==this.type&&this.radio>0&&(this.setMallOrderExtra({sid:this.sid,key:"invoiceId",val:this.radio}),this.setMallOrderExtra({sid:this.sid,key:"invoiceTitle",val:this.invoiceTitle})),this.$router.replace(this.util.getUrl({path:"/mall/pages/order/create",query:{sids:this.sids}}))):("note"==this.type?this.setOrderExtra({key:"note",val:this.note}):"invoice"==this.type&&this.radio>0&&(this.setOrderExtra({key:"invoiceId",val:this.radio}),this.setOrderExtra({key:"invoiceTitle",val:this.invoiceTitle})),this.$router.replace(this.util.getUrl({path:"/pages/order/create?sid="+this.$route.query.sid})))}}),computed:a()({},Object(n.c)(["orderExtra","mallOrderExtra"])),mounted:function(){var t=this.util.parseQuery(this.$route.query);this.query=t,this.sid=t.sid,this.sid?(t.type&&(this.type=t.type),this.channel=t.channel,"mall"==this.channel?(this.mallOrderExtra[this.sid]&&this.mallOrderExtra[this.sid].note&&(this.note=this.mallOrderExtra[this.sid].note),this.mallOrderExtra[this.sid]&&this.mallOrderExtra[this.sid].invoiceId>0&&(this.radio=this.mallOrderExtra[this.sid].invoiceId),this.sids=t.sids):(this.note=this.orderExtra.note||"",this.radio=this.orderExtra.invoiceId||0),this.onLoad()):this.util.$toast("参数错误")}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"order-note"}},[i("public-header",{attrs:{title:"添加备注"}}),t._v(" "),i("div",{staticClass:"content"},["note"==t.type?[i("van-cell-group",{staticClass:"text"},[i("van-field",{attrs:{type:"textarea",placeholder:"请输入备注，最多50字哦"},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}),t._v(" "),t.order_note&&t.order_note.length>0||t.takeoutOrderNote.length>0?i("div",{staticClass:"label-box"},[i("div",{staticClass:"flex-lr font-12 c-gray margin-10-b"},[i("div",[t._v("快捷标签")]),t._v(" "),t.takeoutOrderNote.length>0&&!t.editStatus?[i("div",{staticClass:"flex",on:{click:function(e){t.editStatus=!0}}},[i("i",{staticClass:"icon icon-edit"}),t._v(" "),i("span",{staticClass:"margin-5-l"},[t._v("编辑")])])]:t._e(),t._v(" "),t.editStatus?[i("div",{staticClass:"flex",on:{click:t.onSaveNote}},[i("i",{staticClass:"icon icon-roundcheck"}),t._v(" "),i("span",{staticClass:"margin-5-l"},[t._v("保存")])])]:t._e()],2),t._v(" "),t.takeoutOrderNote.length>0?t._l(t.takeoutOrderNote,function(e,o){return i("div",{key:o,staticClass:"label",on:{click:function(i){return t.onChooseLabel(e)}}},[t._v("\n\t\t\t\t\t\t\t"+t._s(e)+"\n\t\t\t\t\t\t\t"),t.editStatus?i("i",{staticClass:"icon icon-close",on:{click:function(e){return e.stopPropagation(),t.onDeleteNote(o)}}}):t._e()])}):t._e(),t._v(" "),t._l(t.order_note,function(e){return i("div",{staticClass:"label",on:{click:function(i){return t.onChooseLabel(e)}}},[t._v(t._s(e))])})],2):t._e()],1)]:"invoice"==t.type?[i("van-radio-group",{model:{value:t.radio,callback:function(e){t.radio=e},expression:"radio"}},[i("van-cell-group",[i("van-cell",{attrs:{title:"发票"}}),t._v(" "),i("van-cell",{attrs:{title:"不需要发票",clickable:""},on:{click:function(e){t.radio=0}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[i("van-radio",{attrs:{name:0}})]},proxy:!0}])}),t._v(" "),t._l(t.invoices,function(e,o){return i("van-cell",{key:o,attrs:{title:e.title,clickable:""},on:{click:function(i){t.radio=e.id,t.invoiceTitle=e.title}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[i("van-radio",{attrs:{name:e.id}})]},proxy:!0}])})})],2)],1),t._v(" "),i("div",{staticClass:"add-invoice",on:{click:function(e){return t.util.jsUrl("/core/pages/order/invoice",t.query,"replace")}}},[i("i",{staticClass:"icon icon-roundadd"}),t._v("添加发票抬头")])]:t._e(),t._v(" "),i("div",{staticClass:"save-btn"},[i("van-button",{attrs:{type:"danger",size:"large"},on:{click:t.onSubmit}},[t._v("保存")])],1)],2),t._v(" "),i("transition",{attrs:{name:"loading"}},[t.showPreLoading?i("iloading"):t._e()],1)],1)},staticRenderFns:[]};var d=i("VU/8")(l,c,!1,function(t){i("DZ2u")},null,null);e.default=d.exports}});
//# sourceMappingURL=92.51e5cedd0f4e2ad3c659.js.map