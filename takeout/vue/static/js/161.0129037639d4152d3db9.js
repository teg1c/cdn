webpackJsonp([161],{"3fZm":function(t,i){},e23f:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=e("woOf"),o=e.n(a),d=e("Gu7T"),s=e.n(d),c=e("Dd8w"),n=e.n(c),r=e("Cz8s"),l=e("mzkE"),g=e("kEnp"),v=e("NYxO"),p={data:function(){return{sid:0,cid:0,showPreLoading:!0,styleContent:"#fff",is_grant:0,title:"",active:1,diydata:{diy:{data:{},fixedsearch:{},is_has_goodsTab:0,is_has_location:0,is_has_storebasic:0,storebasic_style:1},superRedpacketData:{errno:0,message:{},is_show:!0},config:{},categorySelectedIndex:0,categorySelectedId:0,categoryAll:[],categorySelected:{child:[{}]},childSelectedIndex:0,childSelectedId:0,goodsAll:[],goodsItem:{orderby:{type:"",value:""}},goodsLoading:!0,store:{},shopPage:{},vanColHeight:667},store:{},goodsActive:{},menufooter:{},shop_style:"",ParentPopupSpecShow:!1,popupBuySvip:!1}},components:{PublicHeader:r.a,PublicFooter:l.a,diy:g.a},computed:n()({},Object(v.c)(["istore","icart"]),{goodsSpecNum:function(){if(!this.icart||!this.icart.data1||!this.icart.data1[this.goodsActive.id])return 0;var t=this.goodsActive.activeOptionId;return this.icart.data1[this.goodsActive.id][t]?this.icart.data1[this.goodsActive.id][t].num:0}}),methods:n()({},Object(v.b)(["setLocation","getLocation","replaceStore","replaceCart"]),{onLoad:function(){var t=this;this.util.request({url:"wmall/shop/category",data:{sid:this.sid,cid:this.cid,menufooter:1}}).then(function(i){t.showPreLoading=!1,t.diydata.goodsLoading=!1;var e=i.data.message;e.errno?t.$toast(e.message):(t.diydata.config=e.message.config_mall,t.diydata.diy=t.util.extend(t.diydata.diy,e.message.diy),t.styleContent={"background-color":t.diydata.diy.data.page.background},t.diydata.superRedpacketData=e.message.superRedpacketData,t.diydata.superRedpacketData.is_show=!0,t.util.setWXTitle(t.title),t.menufooter=window.menufooter,t.cart=e.message.cart.message.cart,t.store=e.message.store,t.replaceStore(t.store),t.replaceCart(t.cart),t.store=e.message.store,t.shop_style=t.store.data.shop_style,t.title=t.store.title||"门店首页",1==t.diydata.diy.is_has_storebasic&&(t.diydata.categoryAll=e.message.category,t.diydata.goodsItem={page:2,psize:30,empty:0,data:e.message.goods,orderby:{type:"",value:""}},t.diydata.goodsItem.data.length<t.diydata.goodsItem.psize&&(t.diydata.goodsItem.loaded=!0,t.diydata.goodsItem.data.length||(t.diydata.goodsItem.empty=1)),t.diydata.categorySelectedId=e.message.cid,t.diydata.childSelectedId=e.message.child_id,t.diydata.categorySelectedIndex=e.message.cindex,t.diydata.goodsAll[t.diydata.categorySelectedIndex]=[],t.diydata.goodsAll[t.diydata.categorySelectedIndex][t.diydata.childSelectedIndex]=t.diydata.goodsItem,t.diydata.categorySelected=e.message.category[t.diydata.categorySelectedIndex]||{},t.diydata.store=t.store,t.diydata.shopPage=t.store.data.shopPage))})},onToggleCategory:function(t){t.cid;var i=t.index,e=0;"child"==t.from?(e=i,this.diydata.childSelectedIndex=e,this.diydata.categoryAll[this.diydata.categorySelectedIndex].childSelectedIndex=e,this.diydata.categorySelected=this.diydata.categoryAll[this.diydata.categorySelectedIndex]):(this.diydata.categoryAll[i].childSelectedIndex>0&&(e=this.diydata.categoryAll[i].childSelectedIndex),this.diydata.categorySelected=this.diydata.categoryAll[i],this.diydata.categorySelectedIndex=i,this.diydata.childSelectedIndex=e,this.diydata.categoryAll[i].childSelectedIndex=e),this.diydata.categorySelectedId=this.diydata.categorySelected.id,this.diydata.childSelectedId=0,this.diydata.categorySelected.child&&this.diydata.categorySelected.child.length>0&&(this.diydata.childSelectedId=this.diydata.categorySelected.child[e].id),this.onGetGoods()},onGetGoods:function(){var t=this;if(this.diydata.goodsLoading,this.diydata.goodsAll[this.diydata.categorySelectedIndex]||(this.diydata.goodsAll[this.diydata.categorySelectedIndex]=[]),this.diydata.goodsItem=this.diydata.goodsAll[this.diydata.categorySelectedIndex][this.diydata.childSelectedIndex],this.diydata.goodsItem){if(this.diydata.goodsItem.empty)return!1;if(this.diydata.goodsItem.loaded)return console.log("商品全部加载完成"),!1}else this.diydata.goodsItem={page:1,psize:30,empty:0,loaded:!1,data:[],orderby:{type:"",value:""}};this.diydata.goodsLoading=!0,this.util.request({url:"wmall/store/goods/goods",data:{sid:this.sid,page:this.diydata.goodsItem.page,psize:this.diydata.goodsItem.psize,cid:this.diydata.categorySelectedId,child_id:this.diydata.childSelectedId,type:this.diydata.goodsItem.orderby.type,value:this.diydata.goodsItem.orderby.value}}).then(function(i){t.diydata.goodsLoading=!1;var e=i.data.message.message;t.diydata.goodsItem.data=[].concat(s()(t.diydata.goodsItem.data),s()(e.goods)),t.diydata.goodsItem.page++,e.goods.length<t.diydata.goodsItem.psize&&(t.diydata.goodsItem.loaded=!0,e.goods.length||(t.diydata.goodsItem.empty=1)),t.diydata.goodsAll[t.diydata.categorySelectedIndex]||(t.diydata.goodsAll[t.diydata.categorySelectedIndex]=[]),t.diydata.goodsAll[t.diydata.categorySelectedIndex][t.diydata.childSelectedIndex]=t.diydata.goodsItem})},onOrderby:function(t){var i=t.type,e=t.value;this.diydata.goodsItem={page:1,psize:30,empty:0,data:[],orderby:{type:i,value:e}},this.diydata.goodsAll[this.diydata.categorySelectedIndex][this.diydata.childSelectedIndex]=this.diydata.goodsItem,this.onGetGoods()},onParentPlus:function(t,i,e,a,o){var d=this;this.goodsActive=i;var s=0;if(0==this.icart.pindan_id)if(1==this.icart.is_buysvip)s=1;else if(this.icart.svip_buy_show>=1&&1==i.svip_buy_show){if(1==o)return this.goodsActive.activeOption&&(this.goodsActive.activeOption.origin_price>0?this.goodsActive.origin_price=this.goodsActive.activeOption.origin_price:this.goodsActive.origin_price=this.goodsActive.activeOption.price,this.goodsActive.activeOption.svip_price>0?this.goodsActive.svip_price=this.goodsActive.activeOption.svip_price:this.goodsActive.svip_price=this.goodsActive.activeOption.price),void(this.popupBuySvip=!0);2==o?this.popupBuySvip=!1:3==o&&(this.popupBuySvip=!1,s=1)}var c=i.id||i.goods_id,n=i.activeOptionId||e,r={sid:this.istore.id,goods_id:c,option_id:n,num:1,sign:"+",is_buysvip:s};this.util.request({url:"wmall/store/goods/cart",data:r}).then(function(t){if((t=t.data.message).errno)return d.$toast(t.message),!1;t.message.msg&&d.$toast(t.message.msg),d.replaceCart(t.message.cart)})},onParentMinus:function(t,i,e){var a=this,o=0;1==this.icart.is_buysvip&&(o=1);var d=t.id||t.goods_id,s=t.activeOptionId||i,c={sid:this.istore.id,goods_id:d,option_id:s,num:1,sign:"-",is_buysvip:o};this.util.request({url:"wmall/store/goods/cart",data:c}).then(function(t){if((t=t.data.message).errno)return a.$toast(t.message),!1;a.replaceCart(t.message.cart)})},onParentSelectOption:function(t){this.goodsActive=t,this.goods=t,this.ParentPopupSpecShow=!0,this.goods.activeOptions||this.onParentGoodsOptionInit()},onParentGoodsOptionInit:function(){if(this.goodsActive=this.goods,this.goodsActive.activeOptions={option:0,attrs:[],optionSelected:0,attrsSelected:[],num:0},1==this.goodsActive.is_options&&(this.goodsActive.activeOptions.option=this.goodsActive.options[0].id,this.goodsActive.activeOptions.optionSelected=this.goodsActive.options[0].id),1==this.goodsActive.is_attrs)for(var t=0;t<this.goodsActive.attrs.length;t++)this.goodsActive.activeOptions.attrs.push(t+"s0"),this.goodsActive.activeOptions.attrsSelected[t]=0;this.onParentToggleActiveOption()},onParentToggleActiveOption:function(t){var i=this.goodsActive;t?i.activeOptionId=t:(i.activeOptionId=i.activeOptions.option,i.activeOptions.attrs.length>0&&(i.activeOptionId=i.activeOptionId+"_"+i.activeOptions.attrs.join("v"))),i.activeOption=i.options_data[i.activeOptionId],i.activeOption.num=this.parentGetSpecNum(),this.goodsActive=o()({},i)},parentGetSpecNum:function(){if(!this.icart||!this.icart.data1||!this.icart.data1[this.goodsActive.id])return 0;var t=this.goodsActive.activeOptionId;return this.icart.data1[this.goodsActive.id][t]?this.icart.data1[this.goodsActive.id][t].num:0},onParentToggleOption:function(t,i,e){var a=this.goods;"option"==e?(a.activeOptions.option=t,a.activeOptions.optionSelected=t):(a.activeOptions.attrs[t]=t+"s"+i,a.activeOptions.attrsSelected[t]=i),this.goodsActive=a,this.onParentToggleActiveOption()}}),watch:{icart:function(){var t=this.icart.data,i=this.diydata.categoryAll;if(t)for(var e in i)if(i[e].total=0,i[e].child&&i[e].child.length>0)for(var a in i[e].child){i[e].child[a].total=0;var o=0,d=0;for(var s in t)for(var c in t[s])t[s][c].cid==i[e].id&&(d+=t[s][c].num,i[e].total=d,t[s][c].child_id==i[e].child[a].id&&(o+=t[s][c].num,i[e].child[a].total=o))}else{d=0;for(var s in t)for(var c in t[s])t[s][c].cid==i[e].id&&(d+=t[s][c].num,i[e].total=d)}else for(var e in i)if(i[e].total=0,i[e].child)for(var a in i[e].child)i[e].child[a].total=0;this.diydata.categoryAll=i},$route:function(t,i){this.onLoad()}},created:function(){this.query=this.util.parseQuery(this.$route.query),this.sid=this.query.sid,this.cid=this.query.cid},mounted:function(){var t=this;this.onLoad(),setTimeout(function(){var i=document.documentElement.clientHeight;t.diydata.vanColHeight=i,document.getElementById("public-header")&&(t.diydata.vanColHeight=t.diydata.vanColHeight-46),document.getElementById("public-footer")&&(t.diydata.vanColHeight=t.diydata.vanColHeight-50)},50)}},h={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{class:"shop-"+t.shop_style,attrs:{id:"shop-category"}},[e("public-header",{attrs:{title:t.title}}),t._v(" "),t.menufooter&&t.menufooter.data?e("public-footer",{attrs:{preLoading:t.showPreLoading,menufooter:t.menufooter}}):t._e(),t._v(" "),e("div",{staticClass:"container",class:{"has-child-0":2==t.diydata.diy.storebasic_style,"has-child-4":2==t.diydata.diy.storebasic_style&&t.diydata.categorySelected&&t.diydata.categorySelected.child&&t.diydata.categorySelected.child.length>0&&t.diydata.categorySelected.child.length<=4,"has-child-8":2==t.diydata.diy.storebasic_style&&t.diydata.categorySelected&&t.diydata.categorySelected.child&&t.diydata.categorySelected.child.length>4},style:t.styleContent},[e("diy",{attrs:{diydata:t.diydata,active:t.active,is_grant:t.is_grant,preLoading:t.showPreLoading},on:{onParentPlus:t.onParentPlus,onParentSelectOption:t.onParentSelectOption,onToggleCategory:t.onToggleCategory,onOrderby:t.onOrderby,onGetGoods:t.onGetGoods}})],1),t._v(" "),t.ParentPopupSpecShow?e("van-popup",{staticClass:"options-popup",model:{value:t.ParentPopupSpecShow,callback:function(i){t.ParentPopupSpecShow=i},expression:"ParentPopupSpecShow"}},[e("div",{staticClass:"options-dialog"},[e("div",{staticClass:"muti-close",on:{click:function(i){t.ParentPopupSpecShow=!1}}}),t._v(" "),e("div",{staticClass:"muti-wrap"},[e("div",{staticClass:"muti-food-title border-1px-b"},[t._v("\n\t\t\t\t\t"+t._s(t.goodsActive.title)+"\n\t\t\t\t")]),t._v(" "),e("div",{staticClass:"muti-cont"},[e("div",{staticClass:"muti-cont-inner"},[1==t.goodsActive.is_options?e("div",{staticClass:"muti-sec first"},[e("div",{staticClass:"muti-sec-title"},[t._v("规格")]),t._v(" "),e("div",{staticClass:"muti-choice"},[t._l(t.goodsActive.options,function(i,a){return[e("div",{class:{selected:t.goodsActive.activeOptions.optionSelected==i.id},on:{click:function(e){return t.onParentToggleOption(i.id,"","option")}}},[t._v(t._s(i.name))])]})],2)]):t._e(),t._v(" "),1==t.goodsActive.is_attrs?e("div",{staticClass:"muti-sec"},[t._l(t.goodsActive.attrs,function(i,a){return[e("div",{staticClass:"muti-sec-title"},[t._v(t._s(i.name))]),t._v(" "),e("div",{staticClass:"muti-choice"},[t._l(i.label,function(i,o){return[e("div",{class:{selected:t.goodsActive.activeOptions.attrsSelected[a]==o},on:{click:function(i){return t.onParentToggleOption(a,o,"attr")}}},[t._v(t._s(i))])]})],2)]})],2):t._e()])]),t._v(" "),e("div",{staticClass:"muti-choose"},[e("div",{staticClass:"muti-oprt"},[e("div",{staticClass:"muti-cart-oprt clearfix"},[e("div",{staticClass:"add-food"},[e("van-icon",{staticStyle:{"background-color":"#6BBA50"},attrs:{name:"plus"},on:{click:function(i){return t.onParentPlus(i,t.goodsActive,"","","1")}}})],1),t._v(" "),t.goodsSpecNum?[e("div",{staticClass:"food-num"},[t._v(t._s(t.goodsSpecNum))]),t._v(" "),e("div",{staticClass:"remove-food"},[e("div",{staticClass:"remove icon icon-minus",on:{click:function(i){return t.onParentMinus(t.goodsActive)}}})])]:t._e()],2)]),t._v(" "),e("div",{staticClass:"muti-info"},[e("div",{staticClass:"muti-price"},[t._v(t._s(t.Lang.dollarSign)+t._s(t.goodsActive.activeOption.price))]),t._v(" "),e("div",{staticClass:"muti-type"},[t._v("("+t._s(t.goodsActive.activeOption.name)+")")])])])])])]):t._e(),t._v(" "),e("van-popup",{staticClass:"buy-svip",model:{value:t.popupBuySvip,callback:function(i){t.popupBuySvip=i},expression:"popupBuySvip"}},[e("div",{staticClass:"popup-svip-title"},[t._v("客官，专享价限超级会员享受哦")]),t._v(" "),e("div",{staticClass:"svip-img"},[e("div",{staticClass:"svip-vs-left"},[e("i",{staticClass:"icon icon-crownfill"}),t._v(" "),e("div",{staticClass:"font-12"},[t._v("会员专享价")]),t._v(" "),e("div",{staticClass:"svip-vs-price"},[e("span",{staticClass:"font-14"},[t._v(t._s(t.Lang.dollarSign))]),t._v(t._s(t.goodsActive.svip_price))])]),t._v(" "),e("div",{staticClass:"svip-vs-right"},[e("div",{staticClass:"svip-putong-title"},[t._v("普通用户价格")]),t._v(" "),e("div",{staticClass:"svip-putong-price"},[e("span",{staticClass:"font-14"},[t._v(t._s(t.Lang.dollarSign))]),t._v(t._s(t.goodsActive.origin_price))])])]),t._v(" "),e("div",{staticClass:"buy-svip-text"},[t._v("即刻加入超级会员，尊享众多会员优惠")]),t._v(" "),e("button",{staticClass:"svip-price-btn font-16 margin-15-t"},[e("div",{staticClass:"font-bold",on:{click:function(i){return t.onParentPlus(i,t.goodsActive,"","","3")}}},[t._v("会员专享价购买")]),t._v(" "),e("div",{staticClass:"font-12 padding-5-t"},[t._v("(订单结算时成为会员享优惠)")])]),t._v(" "),e("van-button",{staticClass:"price-btn font-16 margin-15-t",attrs:{size:"normal"},on:{click:function(i){return t.onParentPlus(i,t.goodsActive,"","","2")}}},[t._v("原价购买")])],1)],1)},staticRenderFns:[]};var y=e("VU/8")(p,h,!1,function(t){e("3fZm")},null,null);i.default=y.exports}});
//# sourceMappingURL=161.0129037639d4152d3db9.js.map