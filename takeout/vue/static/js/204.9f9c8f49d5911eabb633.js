webpackJsonp([204],{6668:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Gu7T"),i=s.n(a),o=s("mvHQ"),l=s.n(o),n=s("Dd8w"),r=s.n(n),c=s("Cz8s"),d=s("mzkE"),u=s("Vr3d"),h=s("NYxO"),v={data:function(){return{showPreLoading:!0,menufooter:{},carts:[],checkAll:!1,editOrDelete:"edit",goodsSelected:{edit:[],delete:[]},storeSelected:{edit:[],delete:[]},all:{edit:!1,delete:!1},checkedGoodsArr:[],checkedStoreArr:[],sendLimits:[],finalFee:0,islegal:!1}},computed:r()({},Object(h.c)(["allcart"]),{contentBottom:function(){var t=110;return this.sendLimits.length>0&&(t+=44*this.sendLimits.length),t}}),methods:r()({onSubmit:function(){if(!this.checkedGoodsArr.length||!this.checkedStoreArr.length)return this.util.$toast("请选择要结算的商品"),!1;var t=this.checkedStoreArr.join("_");this.$router.replace(this.util.getUrl({path:"/mall/pages/order/create",query:{sids:t}}))},onLoad:function(){var t=this;t.util.request({url:"wmall/mall/cart",data:{order_id:this.query.order_id,menufooter:1}}).then(function(e){t.showPreLoading=!1;var s=e.data.message;s.errno?t.util.$toast(s.message):(t.islegal=!0,s=s.message,t.menufooter=window.menufooter,s.carts&&t.replaceAllcart(s.carts))})},onStoreCheckAll:function(t){var e=this.allcart[t].sid,s=this.$refs.storeCheckbox[t].value;this.onChangeGoodsIsbubmit(e,0,0,s)},onChangeGoodsBox:function(t,e,s,a){var i="goodsCheckbox-"+s+"-"+a,o=this.$refs[i][0].value;this.onChangeGoodsIsbubmit(e,s,a,o)},onCheckAll:function(){var t=this.$refs["all-checkbox"].value;this.onChangeGoodsIsbubmit(0,0,0,t)},singleDeleteGoods:function(t){var e=t.name,s=[];s.push(e),this.onDeleteGoods(s)},batchDeleteGoods:function(){var t=this.checkedGoodsArr;t.length?this.onDeleteGoods(t):this.util.$toast("请勾选要删除的商品")},onDeleteGoods:function(t){var e=this;e.$dialog.confirm({message:"确定删除选中的商品吗",confirmButtonText:"删除"}).then(function(){e.util.request({url:"wmall/mall/cart/delete",data:{goods:l()(t)}}).then(function(t){var s=t.data.message;s.errno?e.util.$toast(s.message):(s=s.message).carts&&e.replaceAllcart(s.carts)})}).catch(function(){})},onChangeGoodsIsbubmit:function(t,e,s,a){var i=this;i.util.request({url:"wmall/mall/cart/issubmit",data:{sid:t,goods_id:e,option_key:s,issubmit:a?1:0}}).then(function(t){var e=t.data.message;e.errno?i.util.$toast(e.message):(e=e.message).carts&&i.replaceAllcart(e.carts)})},onToggleEditOrDelete:function(t){this.editOrDelete=t}},Object(h.b)(["replaceAllcart"])),watch:{allcart:function(){if(this.allcart){this.carts=[].concat(i()(this.allcart));var t=0,e=[],s=[],a=[],o=[];for(var l in this.allcart)for(var n in t+=this.allcart[l].final_fee,this.allcart[l].send_limit>0&&1==this.allcart[l].cart.has_goods_submit&&e.push({sid:this.allcart[l].sid,title:this.allcart[l].storeName,send_limit:this.allcart[l].send_limit}),s.push(this.allcart[l].cart.isallsubmit),this.allcart[l].cart.data)for(var r in this.allcart[l].cart.data[n]){var c=this.allcart[l].cart.data[n][r];c.issubmit&&(a.push(this.allcart[l].sid+":"+c.goods_id+":"+r),-1==o.indexOf(this.allcart[l].sid)&&o.push(this.allcart[l].sid))}s.length>0&&(s.indexOf(!1)>-1?this.checkAll=!1:this.checkAll=!0),this.sendLimits=[].concat(e),this.finalFee=t.toFixed(2),this.checkedGoodsArr=[].concat(a),this.checkedStoreArr=[].concat(o)}}},created:function(){this.query=this.util.parseQuery(this.$route.query)},mounted:function(){this.onLoad()},components:{PublicHeader:c.a,PublicFooter:d.a,GoodsHandle:u.a}},g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"font-14",attrs:{id:"mall-cart"}},[t.sendLimits.length>0?s("div",{staticClass:"send-limit"},t._l(t.sendLimits,function(e,a){return s("div",{staticClass:"limit-item van-hairline--top"},[s("div",[s("span",{staticClass:"c-danger"},[t._v(t._s(e.title))]),t._v(" "),s("span",[t._v("还差")]),t._v(" "),s("span",{staticClass:"c-danger"},[t._v(t._s(t.Lang.dollarSign)+t._s(e.send_limit))]),t._v(" "),s("span",[t._v("起送")])]),t._v(" "),s("div",{staticClass:"flex-lr c-danger"},[s("span",{on:{click:function(s){return t.util.jsUrl("/pages/store/goods",{sid:e.sid})}}},[t._v("去凑单")]),t._v(" "),s("span",{staticClass:"icon icon-right font-12"})])])}),0):t._e(),t._v(" "),s("div",{staticClass:"submit-bar van-hairline--top-bottom"},[s("van-checkbox",{ref:"all-checkbox",attrs:{"checked-color":"#ff2d4b"},on:{click:t.onCheckAll},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),s("div",{staticClass:"flex"},["edit"==t.editOrDelete?[s("div",{staticClass:"total"},[s("div",[s("span",[t._v("合计：")]),t._v(" "),s("span",{staticClass:"c-danger"},[t._v(t._s(t.Lang.dollarSign))]),t._v(" "),s("span",{staticClass:"font-16 c-danger"},[t._v(t._s(t.finalFee))])]),t._v(" "),s("div",{staticClass:"c-gray"},[t._v("不含配送费")])]),t._v(" "),s("van-button",{attrs:{size:"normal",type:"danger",round:""},on:{click:t.onSubmit}},[t._v("去结算")])]:[s("van-button",{attrs:{size:"normal",type:"danger",round:""},on:{click:t.batchDeleteGoods}},[t._v("删除")])]],2)],1),t._v(" "),s("public-header",{attrs:{title:"购物车"}},["edit"==t.editOrDelete?s("div",{attrs:{slot:"right"},on:{click:function(e){return t.onToggleEditOrDelete("delete")}},slot:"right"},[t._v("编辑")]):s("div",{attrs:{slot:"right"},on:{click:function(e){return t.onToggleEditOrDelete("edit")}},slot:"right"},[t._v("完成")])]),t._v(" "),s("public-footer",{attrs:{preLoading:t.showPreLoading,menufooter:t.menufooter}}),t._v(" "),s("div",{staticClass:"content",style:{bottom:t.contentBottom+"px",paddingBottom:"10px"}},[t.allcart.length>0?[t._l(t.allcart,function(e,a){return[s("div",{staticClass:"store-item"},[s("div",{staticClass:"store-title"},[s("van-checkbox",{ref:"storeCheckbox",refInFor:!0,attrs:{"checked-color":"#ff2d4b"},on:{click:function(e){return t.onStoreCheckAll(a)}},model:{value:t.allcart[a].cart.isallsubmit,callback:function(e){t.$set(t.allcart[a].cart,"isallsubmit",e)},expression:"allcart[cartIndex].cart.isallsubmit"}},[t._v(t._s(e.storeName))]),t._v(" "),s("div",{staticClass:"tips"},[e.send_limit>0?[s("span",{staticClass:"c-gray"},[t._v("再买"+t._s(t.Lang.dollarSign)+t._s(e.send_limit)+"元,")]),t._v(" "),s("span",{on:{click:function(s){return t.util.jsUrl("/pages/store/goods",{sid:e.sid})}}},[t._v("去凑单")])]:[s("span",{on:{click:function(s){return t.util.jsUrl("/pages/store/goods",{sid:e.sid})}}},[t._v("进入店铺")])],t._v(" "),s("span",{staticClass:"icon icon-right font-12"})],2)],1),t._v(" "),t._l(e.cart.data,function(i,o){return s("div",{staticClass:"goods-wrap"},[t._l(i,function(i,o){return[s("van-swipe-cell",{attrs:{disabled:"edit"==t.editOrDelete,name:e.sid+":"+i.goods_id+":"+o},on:{close:t.singleDeleteGoods},scopedSlots:t._u([{key:"right",fn:function(){return[s("van-button",{attrs:{square:"",type:"danger",text:"删除"}})]},proxy:!0}],null,!0)},["88888"!=i.goods_id?s("van-checkbox",{ref:"goodsCheckbox-"+i.goods_id+"-"+o,refInFor:!0,attrs:{"checked-color":"#ff2d4b"},on:{click:function(s){return t.onChangeGoodsBox(a,e.sid,i.goods_id,o)}},model:{value:i.issubmit,callback:function(e){t.$set(i,"issubmit",e)},expression:"option.issubmit"}},[s("div",{staticClass:"goods-item"},[s("div",{staticClass:"goods-thumb van-hairline"},[s("img",{staticClass:"img-100",attrs:{src:i.thumb,alt:""}})]),t._v(" "),s("div",{staticClass:"info"},[s("div",{staticClass:"goods-title"},[t._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+t._s(i.title)+"\n\t\t\t\t\t\t\t\t\t\t\t")]),t._v(" "),s("div",{staticClass:"goods-price"},[t._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+t._s(t.Lang.dollarSign)+t._s(i.total_discount_price)+"\n\t\t\t\t\t\t\t\t\t\t\t")])]),t._v(" "),s("goods-handle",{attrs:{goods:i,from:"cart",optionId:o,cartIndex:a,showAnimate:!1,mode:"all"}})],1)]):t._e()],1)]})],2)})],2)]}),t._v(" "),s("div",{staticClass:"flex-center margin-10-tb"},[s("div",{staticClass:"to-category flex",on:{click:function(e){return t.util.jsUrl("/mall/pages/home/category",{})}}},[s("span",[t._v("继续添加商品")]),t._v(" "),s("i",{staticClass:"icon icon-right font-12 margin-5-l"})])])]:s("div",{staticClass:"no-data"},[s("img",{staticClass:"no-cart",attrs:{src:"static/img/cart_con.png"}}),t._v(" "),s("div",{staticClass:"no-record"},[t._v("您还没有添加购物车，快去购买吧")]),t._v(" "),s("router-link",{staticClass:"target",attrs:{tag:"div",to:t.util.getUrl({path:"/mall/pages/home/category",query:{}})}},[t._v("现在去购物")])],1)],2)],1)},staticRenderFns:[]};var m=s("VU/8")(v,g,!1,function(t){s("eN2y")},null,null);e.default=m.exports},eN2y:function(t,e){}});
//# sourceMappingURL=204.9f9c8f49d5911eabb633.js.map